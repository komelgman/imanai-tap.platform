[TOC]

# Ubiquitous Language

## I. Типы данных (Data Archetypes)

### **Reference Data**

**Что это:** Описательные свойства объектов домена — инструменты, торговые площадки, контрагенты, их спецификации, статусы и маппинги между разными Trading Venue.  
**Примеры:**

* контрактный размер инструмента, тик, торговые часы;
* статус инструмента (active, halted, delisted);
* маппинги Symbol → Canonical Instrument для каждого Venue.

**Ключевые моменты:**

* Свойства имеют временные интервалы действия (`effective_from`, `effective_to`).
* Маппинги Symbol → Instrument позволяют нормализовать данные с разных площадок в единый формат.
* Источник истины для бизнес-логики, аналитики и интеграции между сервисами.
* Даже при частых изменениях (например, halt/resume, новые маппинги) это остаётся Reference Data, не Operational.

**Характер:** Read-heavy, versioned, с интервальными временными метками.

### **Market Data**

**Что это:** Поток внешних наблюдений о рынке: цены, объемы, котировки, ставки финансирования.  
**Примеры:** сделки на Binance, книги ордеров на Deribit, цены funding rate.  
**Ключевые моменты:**

* Иммутабельные тайм-серии.
* Используются для построения графиков, мониторинга состояния рынка, анализа потоков данных.
* Хранятся в специализированных TSDB или потоковых хранилищах.

**Характер:** Write-heavy, append-only, высокие объёмы, устаревают быстро.

### **Transactional Data**

**Что это:** Журнал внутренних бизнес-событий системы.  
**Примеры:** исполненные ордера, переводы, начисления комиссий, клиринг.  
**Ключевые моменты:**

* Immutable, строгая последовательность.
* Источник истины для логики и аудита действий системы.

**Характер:** ACID, критично для корректной работы систем, зависящих от истории событий.

### **Operational Data**

**Что это:** Текущее материализованное состояние системы, полученное применением транзакций к начальному состоянию.  
**Примеры:** текущие позиции пользователя, баланс кошелька, открытые ордера.  
**Ключевые моменты:**

* Derived data, может кэшироваться для быстрого доступа и UI.
* Всегда актуально на конкретный момент времени, но не является источником истины.

**Характер:** Mutable, оптимизировано под быстрый доступ по ключу.

## II. Топология данных (Data Topology)

### **Market Data Source**

**Что это:** Первичный генератор данных.  
**Примеры:** matching engine биржи, движок DEX, внутренний маркет-мейкер.  
**Характер:** определяет lineage и методологию формирования данных.

### **Market Data Provider**

**Что это:** Сервис, предоставляющий доступ к Source и обеспечивающий транспорт и, при необходимости, нормализацию данных.  
**Примеры:** API биржи, агрегатор (CCXT, CoinAPI), внутренний `UnifiedStreamProvider`.  
**Характер:** точка входа в систему, влияет на задержки и качество данных.

### **Feed**

**Что это:** Логический поток данных одного типа от конкретного Provider.  
**Примеры:** `Binance-Spot-Trades`, `Deribit-Options-OrderBook`.  
**Характер:** минимальная единица подписки и обработки; ошибки локализуются на уровне фида.

### **Stream / Channel**

**Что это:** Транспорт, объединяющий один или несколько фидов.  
**Примеры:** WebSocket, Kafka-топик, multiplexed-stream.  
**Характер:** инфраструктурная единица; падение стрима влияет на обработку группы инструментов.

## III. Бизнес-сущности (Business Domain Entities)

### **Trading Venue**

**Что это:** Любое место исполнения сделок, определяющее правила торговли и доступность инструментов.  
**Примеры:** Binance Spot, Uniswap V3, OTC Desk.

### **Exchange**

**Что это:** Централизованная площадка с книгой ордеров (CLOB) и формализованным matching.  
**Примеры:** Binance, BitMEX.

### **Instrument**

**Что это:** Канонический, унифицированный торгуемый объект внутри системы.  
**Примеры атрибутов:** Base Asset, Quote Asset, Contract Size, Tick Size.  
**Ключевые моменты:**

* Унифицированный формат для всех площадок.
* Используется для нормализации и сопоставления данных с разных Venue через Symbol → Instrument mapping.
* Хранит свойства и маппинги, которые меняются во времени.

**Характер:** Reference Data, versioned, интервалы действия обязательны.

### **Symbol**

**Что это:** Идентификатор инструмента на конкретной площадке.  
**Примеры:** `BTCUSDT` (Binance), `XBTUSD` (BitMEX).  
**Ключевые моменты:**

* Требует нормализации через маппинг на Canonical Instrument.  
* Маппинги могут меняться во времени, поэтому versioned.

### **OHLCV**

**Что это:** Тайм-серии агрегированных ценовых данных для инструмента за фиксированный интервал (например, 1 мин, 5 мин, 1 день).  
**Примеры атрибутов:**

* `Open` — цена открытия интервала
* `High` — максимальная цена
* `Low` — минимальная цена
* `Close` — цена закрытия
* `Volume` — суммарный объём за интервал

**Ключевые моменты:**

* Иммутабельные по завершению интервала; для intra-interval могут временно обновляться (например, обновление High/Low до конца минуты).
* Хранятся как Time-Series, обычно в TSDB или агрегированных потоках.
* Используются для визуализации, построения индикаторов, мониторинга и анализа потоков данных.
* Не являются Reference или Operational Data — это **рыночные наблюдения**.

**Характер:** Market Data, Append-only, write-heavy, устаревают после окончания интервала для актуальной обработки, но исторические OHLCV хранятся для аналитики.

### **Orderbook / Quotes**

**Orderbook:** Полное или частичное распределение лимитных ордеров (Bid/Ask) с объёмами.  
**Quotes:** Только лучший Bid и Ask в моменте.  
**Использование:**

* Quotes — быстрые оценки состояния инструмента.
* Orderbook — анализ глубины рынка и симуляция исполнения.

**Характер:** Orderbook — тяжёлые данные с снэпшотами; Quotes — лёгкие, моментальные.
